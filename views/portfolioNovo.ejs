<div class="row-fluid">
    <div class="span12">
        <div class="box paint color_0">
            <div class="title">
                <h4><span>Nova Música</span></h4>
            </div>

            <div class="content">
                <form id="formNovoPortfolio" method="post" action="/admin/portfolio/novo" class="form-horizontal cmxform" autocomplete="off">
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="secao">Seção *</label>
                        <div class="controls span3">
                            <div class="input-prepend row-fluid">
                                <select id="secao" name="secao" class="row-fluid">
                                    <option value="lancamento">Últimos Lançamentos</option>
                                    <option value="outro">Outros Trabalhos</option>
                                    <option value="jingle">Jingles</option>
                                    <option value="pessoal">Pessoal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="nome">Nome da Música *</label>
                        <div class="controls span9">
                            <input id="nome" name="nome" type="text" class="span12" />
                            <label class="error errorRequired" style="display: none;">Por favor, informe o nome da música</label>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="artista">Nome do Artista *</label>
                        <div class="controls span9">
                            <input class="row-fluid" type="text" id="artista" name="artista" />
                            <label class="error errorRequired" style="display: none;">Por favor, informe o nome do artista</label>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="arquivoMusica">Arquivo MP3 *</label>
                        <div class="controls span9">
                            <input id="arquivoMusica" name="arquivoMusica" type="text" class="span12" placeholder="minha_cancao.mp3" />
                            <label class="error errorRequired" style="display: none;">Por favor, informe o nome do arquivo MP3</label>
                            <label class="error errorMinlength" style="display: none;">O nome do arquivo precisa ter pelo menos 5 caracteres</label>
                            <label class="error errorNomeArquivo" style="display: none;">Não é permitio espaços, apenas '-' e '_'. É necessário um '.' separando o nome da extensão do arquivo.</label>
                        </div>
                    </div>
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="arquivoCapaAlbum">Imagem da Capa do CD</label>
                        <div class="controls span9">
                            <input id="arquivoCapaAlbum" name="arquivoCapaAlbum" type="text" class="span12" placeholder="capa_cd.jpg" />
                            <label class="error errorMinlength" style="display: none;">O nome do arquivo precisa ter pelo menos 5 caracteres</label>
                            <label class="error errorNomeArquivo" style="display: none;">Não é permitio espaços, apenas '-' e '_'. É necessário um '.' separando o nome da extensão do arquivo.</label>
                        </div>
                    </div>
                    <!--
                    <div class="form-row control-group row-fluid">
                        <label class="control-label span3" for="arquivoCapaAlbumPlayer">Imagem da Capa do CD no Player</label>
                        <div class="controls span9">
                            <input id="arquivoCapaAlbumPlayer" name="arquivoCapaAlbumPlayer" type="text" class="span12" />
                            <label class="error errorMinlength" style="display: none;">O nome do arquivo precisa ter pelo menos 5 caracteres</label>
                            <label class="error errorNomeArquivo" style="display: none;">Não é permitio espaços, apenas '-' e '_'. É necessário um '.' separando o nome da extensão do arquivo.</label>
                        </div>
                    </div>
                    -->
                    <div class="form-actions row-fluid">
                        <div class="span12">
                            <a href="/admin/portfolio" class="btn btn-large btn-secondary pull-right">Cancelar</a>
                            <button type="submit" class="btn btn-large btn-success pull-right">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>

            <a href="#instrucoesModal" class="btn new_item" data-toggle="modal"><i class="icon-info-sign"></i></a>
        </div>
        <!-- End .box --> 
    </div>
</div>

<!-- Modal -->

<div id="instrucoesModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">Instruções</h3>
    </div>
    <div class="modal-body">
        <h4>Para incluir um novo artista, siga as instruções abaixo</h4>

        <ul>
            <li>Os campos que contém um <b>*</b> são de preenchimento obrigatório, os demais são opcionais</li>
            <li>O arquivo de áudio (mp3) deve ser copiado para a pasta <code>\public\musicas</code></li>
            <li>O arquivo de <em>Imagem da Capa do CD</em> é a imagem que é apresentada na listagem do site</li>
            <li>O arquivo de imagem da capa do CD deve ser copiado para a pasta <code>\public\img\cd</code></li>
            <li>O tamanho ideal para a imagem da capa do CD é de <code>157 x 157</code> pixels</li>
        </ul>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-dismiss="modal">Fechar</button>
    </div>
</div>

<script src="/js/jquery.meio.mask.min.js"></script>
<!--<script src="/js/app/formDadosPessoais.js"></script>-->

<script>
    $(function () {
        // validações

        var gerarErroRequired = function (e) {
            var haErros = false;
            var campo = $(e.currentTarget);

            if (campo.val() === '') {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorRequired').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorRequired').hide();
            }

            return haErros;
        };

        var gerarErroMinlength = function (e, minlength) {
            var haErros = false;
            var campo = $(e.currentTarget);

            if (campo.val() !== '' && campo.val().length < minlength) {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorMinlength').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorMinlength').hide();
            }

            return haErros;
        };

        var gerarErroNomeArquivo = function (e) {
            var haErros = false;
            var campo = $(e.currentTarget);

            var regexp = /[a-zA-Z0-9\.\-\_]{1,}\.{1}[a-zA-Z0-9\.\-\_]{3,4}/;

            if (campo.val() !== '' && !regexp.test(campo.val())) {
                haErros = true;
                campo.addClass('error');
                campo.siblings('.error').hide();
                campo.siblings().filter('.errorNomeArquivo').show();
            } else {
                campo.removeClass('error');
                campo.siblings().filter('.errorNomeArquivo').hide();
            }

            return haErros;
        };

        // campos

        var campoNome = $('[name=nome]').focus();
        var campoArtista = $('[name=artista]');
        var campoArquivoMusica = $('[name=arquivoMusica]');
        var campoArquivoCapaAlbum = $('[name=arquivoCapaAlbum]');

        // eventos

        var verificarErrosDoCampoNome = function (e) {
            var haErro = false;
            haErro = gerarErroRequired(e);

            return haErro;
        };

        var verificarErrosDoCampoArtista = function (e) {
            var haErro = false;
            haErro = gerarErroRequired(e);

            return haErro;
        };

        var verificarErrosDoCampoArquivoMusica = function (e) {
            var haErro = false;
            haErro = gerarErroRequired(e);

            if (!haErro) {
                haErro = gerarErroMinlength(e, 5);
            }

            if (!haErro) {
                haErro = gerarErroNomeArquivo(e);
            }

            return haErro;
        };

        var verificarErrosDoCampoArquivoImagem = function (e) {
            var haErro = false;

            haErro = gerarErroMinlength(e, 5);

            if (!haErro) {
                haErro = gerarErroNomeArquivo(e);
            }

            return haErro;
        };

        // Bind de eventos

        campoNome.on('keyup', verificarErrosDoCampoNome);
        campoArtista.on('keyup', verificarErrosDoCampoArtista);
        campoArquivoMusica.on('keyup', verificarErrosDoCampoArquivoMusica);
        campoArquivoCapaAlbum.on('keyup', verificarErrosDoCampoArquivoImagem);

        // disparar verificação de validação de campos no submit do form

        $("#formNovoPortfolio").on('submit', function (e) {
            var haErros = false;

            haErros = verificarErrosDoCampoNome({ currentTarget: campoNome });
            if (haErros) { verificarErrosDoCampoArtista({ currentTarget: campoArtista }); } else { haErros = verificarErrosDoCampoArtista({ currentTarget: campoArtista }); }
            if (haErros) { verificarErrosDoCampoArquivoMusica({ currentTarget: campoArquivoMusica }); } else { haErros = verificarErrosDoCampoArquivoMusica({ currentTarget: campoArquivoMusica }); }
            if (haErros) { verificarErrosDoCampoArquivoImagem({ currentTarget: campoArquivoCapaAlbum }); } else { haErros = verificarErrosDoCampoArquivoImagem({ currentTarget: campoArquivoCapaAlbum }); }

            var haAlgumaMensagemDeErroSendoExposta = $(e.currentTarget).find('.error:visible').length;

            if (!haErros && haAlgumaMensagemDeErroSendoExposta) {
                haErros = true;
            }

            if (haErros) {
                e.preventDefault();
            }
        });
    });
</script>